const __exports={},define=function(t,e,s){const i=[null,__exports[t]={}];for(let t=2;t<e.length;t++)i.push(__exports[e[t]]);s.apply(null,i)};define("common",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.debug=!1,e.delta=[-40,1,40,-1],e.cw=(t=>(++t>=4&&(t-=4),t)),e.ccw=(t=>(--t<0&&(t+=4),t));class s{constructor(t){this.length=0,this.items=new Array(t)}push(t){this.items[this.length++]=t}pop(){return this.items[--this.length]}popSafe(){return this.length<=0?void 0:this.pop()}pushEmpty(){let t=this.items[this.length];return t||(t={},this.items[this.length]=t),this.length++,t}clear(){this.length=0}}e.FastStack=s;class i{constructor(t,e){this.create=t,this.instances=new s(e);for(let t=0;t<e;t++)this.instances.push(this.create())}getObject(){let t=this.instances.popSafe();return t||(t=this.create(),this.instances.push(t)),t}release(t){this.instances.push(t)}}e.Pool=i;class r{constructor(){this.length=0,this.hash={}}get(t){return this.hash[t]}set(t,e){const s=this.hash[t];s!==e&&(s||this.length++,this.hash[t]=e)}remove(t){this.hash[t]&&(delete this.hash[t],this.length--)}hasKey(t){return void 0!==this.hash[t]}*[Symbol.iterator](){for(let t in this.hash)yield this.hash[t]}}e.Dictionary=r}),define("path",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.path={queue:new Array(880),hash:Buffer.allocUnsafe(880),distances:new Array(880)}}),define("graph",["require","exports","common","path"],function(t,e,s,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=32,h=9,l=15,o=18,a=1e4,n=(t,e)=>t-e,c=(t,e)=>t.point-e.point,d=(t,e)=>t.index-e.index;class u{constructor(t){this.world=t,this.counter=0,this.map=new Array(880);const e=this.world.diamonds+9*this.world.butterflies;this.allDiamonds=new Array(e),this.nodes=new Array(e),this.nodeEdges=new Array(e),this.clusters=new Array(e),this.clusterEdges=new Array(e);for(let t=0;t<e;t++)this.nodeEdges[t]=new Array(e),this.clusterEdges[t]=new Array(e);this.clustersHash=Buffer.allocUnsafe(e),this.temp=new Array(e)}search(){const t=this.world.cells,e=this.nodes,s=this.nodeEdges,o=this.clusters,a=this.clusterEdges,u=this.findDiamonds(this.world.playerPoint,this.allDiamonds);if(0===u)return;const f=this.allDiamonds.slice(0,u).sort(n);for(let t=0;t<u;t++){const s=f[t];e[t]={index:t,point:s,edgesLength:0,marked:!1},this.map[s]=t}for(let t=0;t<u;t++){const e=s[t];for(let t=0;t<u;t++)e[t]=0}for(let h=0;h<u;h++){const o=e[h];for(let i=0;i<u;i++)s[h][i]>0&&(t[e[i].point]|=r);const a=this.findDiamonds(o.point,this.temp,l);for(let t=0;t<a;t++){const r=this.temp[t],l=this.map[r],a=e[l],n=i.path.distances[r];s[h][l]=n,s[l][h]=n,o.edgesLength++,a.edgesLength++}for(let s=0;s<u;s++)t[e[s].point]&=~r}let p=0;for(;;){let t,i=void 0;for(let s=0;s<u;s++){const r=e[s];void 0===r.clusterIndex&&(void 0===i||r.edgesLength<i)&&(i=r.edgesLength,t=r)}if(!t)break;const r={index:p,marked:!1};o[p++]=r,t.clusterIndex=r.index;for(let i=0;i<u;i++)if(t.index!==i){const l=s[t.index][i];if(l>0&&l<=h){const t=e[i];void 0===t.clusterIndex&&(t.clusterIndex=r.index)}}}for(let t=0;t<p;t++){const e=a[t];for(let t=0;t<p;t++)e[t]=0}for(let t=0;t<p;t++)for(let i=0;i<u;i++){const r=e[i];if(r.clusterIndex===t)for(let h=0;h<u;h++){if(i===h)continue;const l=s[r.index][h];if(l>0){const s=e[h].clusterIndex;if(t!==s){const e=a[t][s];(0===e||l<e)&&(a[t][s]=l,a[s][t]=l)}}}}const w=[];this.clustersHash.fill(0);for(let t=0;t<u;t++){const s=this.allDiamonds[t],i=e[this.map[s]].clusterIndex;0===this.clustersHash[i]&&(this.clustersHash[i]=1,w.push(o[i]))}let m,y;const b=[],k=w.slice().sort(d);this.searchOptimalPath(w,k,a,b)?(m=b[0],y=b[1]):(m=w[0],y=w[1]);let g=[];for(let t=0;t<u;t++){const s=this.allDiamonds[t],i=e[this.map[s]];i.clusterIndex===m.index&&g.push(i)}if(y){const t=m.index,i=y.index,r=a[t][i];if(r>0){let h;for(let l=0;l<u;l++){const o=e[l];if(o.clusterIndex===t){for(let t=0;t<u;t++)if(l!==t&&e[t].clusterIndex===i&&s[l][t]===r){h=o;break}if(h){const t=g.indexOf(h);g.splice(t,1),g.push(h);break}}}}}let x;const v=[],D=g.slice().sort(c);x=this.searchOptimalPath(g,D,s,v)?v[0]:g[0];const S=this.findDirectionToPoint(this.world.playerPoint,x.point);return{point:x.point,direction:S}}searchOptimalPath(t,e,s,i){this.counter=0;const r=t.length;for(let h=0;h<r;h++)if(this.searchOptimalPathInternal(t[h],e,s,r,i))return!0;return!1}searchOptimalPathInternal(t,e,s,i,r){if(this.counter>a)return!1;if(this.counter++,r.push(t),r.length===i)return!0;t.marked=!0;for(let h of e){if(t===h||h.marked)continue;const l=s[t.index][h.index];if(!(0===l||l>o)&&this.searchOptimalPathInternal(h,e,s,i,r))return t.marked=!1,!0}return t.marked=!1,r.pop(),!1}findDiamonds(t,e,h){const l=this.world.cells,o=i.path.hash,a=i.path.queue,n=i.path.distances;o.fill(0),o[t]=1,n[t]=0;let c=0,d=0;a[c++]=t;let u=0;for(;d<c;){const t=a[d++],i=n[t];if(void 0!==h&&i>=h&&u>0)break;for(let h=0;h<4;h++){const d=t+s.delta[h];if(d<0||d>=880||0!==o[d])continue;o[d]=1,n[d]=i+1;const f=l[d],p=15&f;5===p&&0==(256&f)&&0==(f&r)&&(e[u++]=d),0!==p&&3!==p&&5!==p&&8!==p||(a[c++]=d)}}return u}findDirectionToPoint(t,e){i.path.hash.fill(255),i.path.hash[t]=4;let r=0,h=0;i.path.queue[r++]=t;let l;for(;!l&&h<r;){const t=i.path.queue[h++];for(let h=0;h<4;h++){const o=t+s.delta[h];if(o<0||o>=880||255!==i.path.hash[o])continue;if(i.path.hash[o]=h,o===e){l=o;break}const a=15&this.world.cells[o];0!==a&&3!==a&&5!==a||(i.path.queue[r++]=o)}}if(l){let e=l,r=4;for(;e!==t;){let t=(r=i.path.hash[e])+2;t>3&&(t-=4),e+=s.delta[t]}return r}return 4}}e.Graph=u}),define("changeset",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(t){this.world=t,this.cellDifs=new Array(100),this.length=0}init(){this.length=0,this.frame=this.world.frame,this.score=this.world.score,this.scoredExpiry=this.world.scoredExpiry,this.streak=this.world.streak,this.streakExpiry=this.world.streakExpiry,this.streaks=this.world.streaks,this.longestStreak=this.world.longestStreak,this.diamonds=this.world.diamonds,this.diamondsCollected=this.world.diamondsCollected,this.butterflies=this.world.butterflies,this.butterfliesKilled=this.world.butterfliesKilled,this.isSettled=this.world.isSettled,this.playerPoint=this.world.playerPoint,this.playerAlive=this.world.playerAlive}revert(){this.world.frame=this.frame,this.world.score=this.score,this.world.scoredExpiry=this.scoredExpiry,this.world.streak=this.streak,this.world.streakExpiry=this.streakExpiry,this.world.streaks=this.streaks,this.world.longestStreak=this.longestStreak,this.world.diamonds=this.diamonds,this.world.diamondsCollected=this.diamondsCollected,this.world.butterflies=this.butterflies,this.world.butterfliesKilled=this.butterfliesKilled,this.world.isSettled=this.isSettled,this.world.playerPoint=this.playerPoint,this.world.playerAlive=this.playerAlive;for(let t=this.length-1;t>=0;t--){const e=this.cellDifs[t];this.world.cells[e.point]=this.world.markCell(e.old)}}add(t){this.cellDifs[this.length++]=t}}e.ChangeSet=s}),define("search",["require","exports","common","changeset"],function(t,e,s,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class r{constructor(t,e){this.world=t,this.maxPossibleDepth=e,this.changeSetPool=new s.Pool(()=>new i.ChangeSet(this.world),e)}depthFirstSearch(t,e){if(s.debug){this.checkArray||(this.checkArray=new Array(880));for(let t=0;t<880;t++)this.checkArray[t]=-129&this.world.cells[t]&-257}if(this.depthFirstSearchInternal(0,t,e),s.debug)for(let t=0;t<880;t++)if(this.checkArray[t]!==(-129&this.world.cells[t]&-257))throw new Error("failed!!!");return this.searchResult}depthFirstSearchInternal(t,e,s,i,r){const h=this.world,l=s.calc();if((void 0===i||l>i)&&(r=t),t>0&&-100===l||t>=e)return{value:l,depth:r};let o={value:-100,depth:0},a=4;const n=h.playerPoint,c=new Array(5);for(let i=0;i<5;i++){let d=void 0;const u=this.world.possibleStep(i);if((2!==u||4===i)&&(3===u&&(d=-100),void 0===d)){const c=this.changeSetPool.getObject();if(c.init(),h.changeSet=c,h.control(i),h.update(),4===i||h.playerPoint!==n){const h=this.depthFirstSearchInternal(t+1,e,s,l,r);(h.value>o.value||h.value===o.value&&h.depth<o.depth)&&(o=h,a=i),d=h.value}h.changeSet=void 0,c.revert(),this.changeSetPool.release(c)}if(c[i]=d,4===i)for(let t=0;t<4;t++)void 0===c[t]&&(c[t]=d)}return 0===t&&(this.searchResult={isFound:o.value!==l,direction:a,steps:c}),o}}e.Search=r}),define("ai",["require","exports","common","graph","path","search"],function(t,e,s,i,r,h){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const l=120,o=14;class a{constructor(t){this.world=t}calc(){return!this.world.playerAlive||this.world.isDead()?-100:this.world.isLocked()?-10:this.world.diamonds}}class n{constructor(t){this.world=t}calc(){return!this.world.playerAlive||this.world.isDead()?-100:this.world.score}}class c{constructor(t){this.world=t}calc(){return!this.world.playerAlive||this.world.isDead()?-100:this.world.isLocked()?-10:this.world.butterfliesKilled}}class d{constructor(t){this.world=t}calc(){return!this.world.playerAlive||this.world.isDead()?-100:this.world.isLocked()?-10:this.world.isPlayerClosed()?0:1}}class u{constructor(t,e){this.world=t,this.maxDepth=e,this.waiting=o,this.history=new Array(1200),this.startHistoryFrame=0,this.badButterflies=0,this.badDiamonds=0,this.rejectCounter=0,this.graphSearchCalled=!1,this.search=new h.Search(t,e),this.graph=new i.Graph(t),this.butterflyFitness=new a(t),this.emptyFitness=new c(t),this.scoreFitness=new n(t),this.unlockFitness=new d(t),this.oldButterfliesKilled=t.butterfliesKilled,this.oldDiamondsCollected=t.diamondsCollected,this.butterflyStartFrame=t.frame,this.state=0,this.previousState=this.state}process(){const t=this.world;this.butterflyJustKilled=t.butterfliesKilled>this.oldButterfliesKilled,this.butterflyJustKilled&&(this.butterflyStartFrame=this.world.frame),this.updateState();let e=4;switch(this.state){case 0:case 1:e=this.searchButterfly();break;case 2:case 3:e=this.searchDiamond();break;case 4:e=this.wait();break;case 5:e=this.unlock();break;case 6:e=4}return this.oldButterfliesKilled=t.butterfliesKilled,this.oldDiamondsCollected=t.diamondsCollected,this.history[t.frame]={point:t.playerPoint,direction:e},e}updateState(){const t=this.world;if(0===t.diamonds&&0===t.butterflies)return void this.goTo(6);const e=t.isPlayerClosed();let s;do{switch(s=this.state,e&&this.goTo(5),this.state){case 0:t.butterflies>0?t.butterflies===this.badButterflies&&this.goTo(1):this.goTo(2);break;case 1:t.butterflies===this.badButterflies&&this.goTo(2);break;case 2:t.diamonds>0?t.diamonds===this.badDiamonds&&this.goTo(3):this.goTo(1);break;case 3:t.diamonds===this.badDiamonds&&this.goTo(1);break;case 4:this.butterflyJustKilled&&this.goTo(4,!0),this.waiting<=0&&this.goTo(2);break;case 5:e||this.goTo(this.previousState)}}while(s!==this.state)}goTo(t,e=!1){const s=this.state;if(this.state!==t||e)switch(this.state=t,this.rejectCounter=0,this.startHistoryFrame=this.world.frame,t){case 0:break;case 1:this.resetButterflies();break;case 2:this.graphSearchCalled=!1,this.butterflyJustKilled&&this.goTo(4);break;case 3:this.resetDiamonds();break;case 4:this.waiting=o;break;case 5:this.previousState=s}}searchButterfly(){const t=this.world.frame<2?this.maxDepth-1:this.maxDepth,e=this.search.depthFirstSearch(t,this.butterflyFitness);if(!e.isFound){let t=4;const s=this.findDirectionToButterfly(!0)||this.findDirectionToButterfly(!1);if(s?(this.rejectCounter=0,t=s.direction,(this.world.frame-this.butterflyStartFrame>l||this.checkLoop())&&(this.rejectButterfly(s.point),this.startHistoryFrame=this.world.frame,this.butterflyStartFrame=this.world.frame)):this.rejectCounter++>=2&&this.rejectAllButterflies(),e.steps[t]>=0)return t}return e.direction}searchDiamond(){const t=0!==this.world.butterflies&&this.graphSearchCalled?this.maxDepth:this.maxDepth-1,e=this.search.depthFirstSearch(t,this.emptyFitness);if(!e.isFound){const t=this.graph.search();this.graphSearchCalled=!0;const s=t?t.direction:4;if(t?(this.rejectCounter=0,this.checkLoop()&&(this.rejectDiamond(t.point),this.startHistoryFrame=this.world.frame)):this.rejectCounter++>=2&&this.rejectAllDiamonds(),e.steps[s]>=0)return s}return e.direction}searchBadDiamond(){const t=this.search.depthFirstSearch(this.maxDepth,this.scoreFitness);return t.isFound,t.direction}unlock(){const t=this.search.depthFirstSearch(this.maxDepth-1,this.unlockFitness);if(!t.isFound){let e=Math.floor(4*Math.random());for(let s=0;s<4;s++)if((e+=s)>=4&&(e-=4),t.steps[e]>=0&&1===this.world.possibleStep(e))return e}return t.direction}wait(){this.waiting--;const t=this.search.depthFirstSearch(this.maxDepth,this.emptyFitness);if(!t.isFound){if(t.steps[4]>=0)return 4}return t.direction}findDirectionToButterfly(t){const e=this.world.playerPoint;r.path.hash.fill(255),r.path.hash[e]=4;let i=0,h=0;r.path.queue[i++]=e;let l;for(;!l&&h<i;){const e=r.path.queue[h++];for(let h=0;h<4;h++){const o=e+s.delta[h];if(o<0||o>=880||255!==r.path.hash[o])continue;r.path.hash[o]=h;const a=this.world.cells[o],n=15&a;if(6===n&&0==(256&a)){l=o;break}(0===n||3===n||8===n||!t&&5===n)&&(r.path.queue[i++]=o)}}if(l){let t=0,i=l,h=4;for(;i!==e;){let e=(h=r.path.hash[i])+2;e>3&&(e-=4),i+=s.delta[e],t++}return{point:l,direction:h,distance:t}}}rejectButterfly(t){this.world.cells[t]|=256,this.badButterflies++}rejectDiamond(t){this.world.cells[t]|=256,this.badDiamonds++}rejectAllButterflies(){const t=this.world.cells;for(let e=41;e<=839;e++)6==(15&t[e])&&(t[e]|=256);this.badButterflies=this.world.butterflies}rejectAllDiamonds(){const t=this.world.cells;for(let e=41;e<=839;e++)5==(15&t[e])&&(t[e]|=256);this.badDiamonds=this.world.diamonds}resetButterflies(){const t=this.world.cells;for(let e=41;e<=839;e++)6==(15&t[e])&&(t[e]&=-257);this.badButterflies=0}resetDiamonds(){const t=this.world.cells;for(let e=41;e<=839;e++)5==(15&t[e])&&(t[e]&=-257);this.badDiamonds=0}checkLoop(){let t=this.world.frame-1;if(t<this.startHistoryFrame)return!1;let e=1;for(;t>=0&&e<10;){if(this.checkLoopInternal(t,e,3))return!0;e++}return!1}checkLoopInternal(t,e,s){let i=t-s*e;if(i<this.startHistoryFrame)return!1;const r=t-e;for(;i<=r;){const t=this.history[i],s=this.history[i+e];if(t.point!==s.point||t.direction!==s.direction)return!1;i++}return!0}}e.AI=u}),define("world",["require","exports","common","path"],function(t,e,s,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=new Array(4),h=new Array(4);class l{constructor(t){this.screen=t,this.frame=0,this.score=0,this.scoredExpiry=0,this.streak=0,this.streakExpiry=0,this.streaks=0,this.longestStreak=0,this.diamonds=0,this.diamondsCollected=0,this.butterflies=0,this.butterfliesKilled=0,this.playerAlive=!0,this.isSettled=!1,this.mark=!1,this.playerDirection=4,this.cells=new Array(880);for(let e=0;e<22;e++)for(let s=0;s<40;s++){const i=40*e+s,r=this.createCell(t[e][s]);switch(15&r){case 8:this.playerPoint=i;break;case 5:this.diamonds++;break;case 6:this.butterflies++}this.cells[i]=r}}update(){this.frame++,this.streak&&(--this.streakExpiry?this.isSettled=!1:(this.streak=0,this.isSettled=!0)),this.scoredExpiry&&this.scoredExpiry--,this.mark=!this.mark;for(let t=41;t<=839;t++){const e=this.cells[t];0!==e&&1!==e&&3!==e&&2!==e&&(this.updateCell(t,e),this.isSettled&&!this.isCellSettled(e)&&(this.isSettled=!1))}this.frame>=1200&&(this.playerAlive=!1)}markCell(t){return 0===t||1===t||3===t||2===t?t:this.mark?128|t:-129&t}set(t,e,s=!0){let i=this.cells[t];s&&(e=this.markCell(e)),this.cells[t]=e,this.changeSet&&this.changeSet.add({point:t,old:i})}updateLooseThing(t,e){const s=t+40,i=this.cells[s];if(0!==i){if(this.isRounded(i)&&(this.roll(e,t,t+-1)||this.roll(e,t,t+1)))return;return(16&e)>0?(this.set(t,-17&e),void this.hit(s,i)):e}this.set(t,0),this.set(s,16|e)}updateExplosion(t,e){let s=(96&e)>>5;if(!(++s>3))return-97&e|s<<5;this.set(t,5)}updateButterfly(t,e){for(let e=0;e<4;e++)r[e]=t+s.delta[e],h[e]=this.cells[r[e]];let i=!0;for(let e of h)if(0===e)i=!1;else if(8==(15&e))return void this.explode(t);if(i)return void this.explode(t);const l=(96&e)>>5,o=s.ccw(l);if(0===h[o])return this.set(t,0),void this.set(r[o],-97&e|o<<5);if(0!==h[l])return-97&e|s.cw(l)<<5;this.move(t,r[l])}updatePlayer(t,e){if(!this.playerAlive||4===this.playerDirection)return e;const i=t+s.delta[this.playerDirection],r=this.cells[i];return 0===r||this.walkInto(r,i,this.playerDirection)?(this.move(t,i),void(this.playerPoint=i)):e}updateCell(t,e){if(this.mark===(128&e)>0)return;let s;switch(15&e){case 4:case 5:s=this.updateLooseThing(t,e);break;case 7:s=this.updateExplosion(t,e);break;case 6:s=this.updateButterfly(t,e);break;case 8:s=this.updatePlayer(t,e);break;default:return}void 0!==s&&(e!==s?this.set(t,s):this.cells[t]=this.markCell(s))}move(t,e,s=!0){const i=this.cells[t];this.set(t,0),this.set(e,i,s)}isRounded(t){const e=15&t;return 2===e||(4===e||5===e)&&0==(16&t)}isConsumable(t){const e=15&t;return!(7===e||1===e)}isCellSettled(t){return 7!=(15&t)&&0==(16&t)}hit(t,e){const s=15&e;6===s?this.explode(t):8===s&&(this.playerAlive=!1)}roll(t,e,s){return 0===this.cells[s]&&0===this.cells[s+40]&&(this.set(e,0),this.set(s,16|t),!0)}walkInto(t,e,i){const r=15&t;if(3===r)return!0;if(5===r)return this.diamondCollected(),!0;if(4===r){if((16&t)>0||0===i||2===i)return!1;const r=e+s.delta[i];return 0===this.cells[r]&&(this.move(e,r,!1),!0)}return!1}explode(t){this.set(t,9,!1);for(let e=-1;e<=1;e++){const s=t+40*e-1,i=s+2;for(let e=s;e<=i;e++){const s=this.cells[e];if(0!==s){if(!this.isConsumable(s))continue;e!==t&&this.hit(e,s)}const i=15&this.cells[e];5!==i&&7!==i&&this.diamonds++,this.set(e,7)}}this.butterflyKilled()}diamondCollected(){if(this.score++,this.diamonds--,this.diamondsCollected++,this.streak++,this.streakExpiry=20,this.scoredExpiry=8,!(this.streak<3)){3===this.streak&&this.streaks++,this.longestStreak<this.streak&&(this.longestStreak=this.streak);for(let t=2;t*t<=this.streak;t++)if(this.streak%t==0)return;this.score+=this.streak}}butterflyKilled(){this.playerAlive&&(this.butterflies--,this.butterfliesKilled++,this.score+=10,this.scoredExpiry=8)}control(t){this.playerDirection=t}isFinal(){return!this.playerAlive&&this.isSettled}isDead(){const t=this.cells[this.playerPoint+-40],e=15&t;return 6===e||4===e&&(16&t)>0}possibleStep(t){if(4===t){for(let t=0;t<4;t++){const e=this.playerPoint+s.delta[t],i=this.cells[e];if(6===(15&i))return 3;if(0===t){if((16&i)>0)return 3;if(0===i&&4==(15&this.cells[e+-40]))return 3}}return 1}const e=this.playerPoint+s.delta[t],i=this.cells[e],r=15&i;if(6===r)return 3;if(1===r||2===r||3!==t&&7===r)return 2;if(0===t&&4===r)return 2;if(1===t&&4===r&&((16&i)>0||0!==this.cells[e+1]))return 2;if(2===t&&4===r)return 2;if(3===t){if(4===r&&0!==this.cells[e+-1]&&0!==this.cells[e+40])return 2;if(7===r&&(96&i)>>5<3)return 2}return 1}isPlayerClosed(){i.path.hash.fill(0),i.path.hash[this.playerPoint]=1;let t=0,e=0;for(i.path.queue[t++]=this.playerPoint;e<t;){const r=i.path.queue[e++];if(e>=20)return!1;for(let e=0;e<4;e++){const h=r+s.delta[e];if(h<0||h>=880||i.path.hash[h]>0)continue;i.path.hash[h]=1;const l=15&this.cells[h];0!==l&&3!==l&&5!==l||(i.path.queue[t++]=h)}}return!0}isLocked(){i.path.hash.fill(0),i.path.hash[this.playerPoint]=1;let t=0,e=0;for(i.path.queue[t++]=this.playerPoint;e<t;){const r=i.path.queue[e++];if(e>=10)return!1;for(let e=0;e<4;e++){const h=r+s.delta[e];h<0||h>=880||i.path.hash[h]>0||(i.path.hash[h]=1,this.isStepAvailable(r,e)&&(i.path.queue[t++]=h))}}return!0}isStepAvailable(t,e){const i=s.delta[e],r=t+i,h=15&this.cells[r];if(1===h||2===h)return!1;if(0===e||2===e){if(4===h)return!1}else if(4===h&&0!==this.cells[r+i]&&0!==this.cells[r+40])return!1;return!0}createCell(t){switch(t){case" ":return 0;case"#":return 1;case"+":return 2;case":":return 3;case"O":return 4;case"*":return 5;case"-":case"/":case"|":case"\\":return 6;case"A":return 8;default:throw new Error("Unknown character: "+t)}}renderCell(t){const e=15&t;switch(e){case 0:return" ";case 1:return"#";case 2:return"+";case 3:return":";case 4:return"O";case 5:return"*";case 7:return"$";case 6:return"%";case 8:return"A";default:throw new Error("Unknown cell type: "+e)}}renderScreen(){let t=new Array(22),e="",s=0,i=0;for(let r of this.cells)e+=this.renderCell(r),++s>=40&&(t[i]=e,e="",s=0,i++);return t}compare(){let t=0,e=0;for(let s=0;s<22;s++)for(let i=0;i<40;i++){const r=40*s+i,h=15&this.cells[r],l=7===h?5:h,o=this.createCell(this.screen[s][i]);if(l!==o)throw new Error(`Difference! cell(${i}, ${s}): current=${h}, expected=${o}`);switch(o){case 5:t++;break;case 6:e++}}const s=parseInt(this.screen[this.screen.length-1].substr(8,6));if(s!==this.score)throw new Error(`Difference! score=${this.score}, expected=${s}`);if(t!==this.diamonds)throw new Error(`Divergence! diamonds=${this.diamonds}, expected=${t}`);if(e!==this.butterflies)throw new Error(`Difference! butterflies=${this.butterflies}, expected=${e}`)}warmUp(){for(let t=0;t<22;t++)for(let e=0;e<40;e++){const s=40*t+e,i=15&this.cells[s];switch(7===i?5:i){case 5:0;break;case 6:0}}}}e.World=l}),define("bot",["require","exports","common","world","ai"],function(t,e,s,i,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const h=5;class l{constructor(t){this.maxDepth=h,this.maxElapsed=0,this.screen=t,this.world=new i.World(this.screen),this.ai=new r.AI(this.world,this.maxDepth)}play(){if(s.debug?(this.world.compare(),console.log(`frame: ${this.world.frame}`)):this.world.frame<2&&this.world.warmUp(),0===this.world.butterflies&&0===this.world.diamonds)return"q";const t=(new Date).getTime();let e=this.ai.process();const i=(new Date).getTime()-t;switch(s.debug&&(i>this.maxElapsed&&(this.maxElapsed=i),console.log(`maxTime: ${this.maxElapsed}`)),s.debug||(i>=96?(this.maxDepth=h-1,e=4):i<50&&(this.maxDepth=h)),this.world.control(e),this.world.update(),e){case 0:return"u";case 1:return"r";case 2:return"d";case 3:return"l";case 4:return""}}}e.Bot=l}),define("solution",["require","exports","bot"],function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});module.exports.play=function*(t){const e=new s.Bot(t);for(;;)yield e.play()}});