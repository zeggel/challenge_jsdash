'use strict';function find_player(a){for(let c,b=0;b<a.length;b++){c=a[b];for(let d=0;d<c.length;d++)if('A'==c[d])return{x:d,y:b}}}function can_go_up_ws(a,b,c){return' :'.includes(c[a-1][b])&&!(' '==c[a-1][b]&&'O*'.includes(c[a-2][b])||' '==c[a-1][b]&&' '==c[a-2][b]&&'+*O'.includes(c[a-1][b-1])&&'O*'.includes(c[a-2][b-1])||' '==c[a-1][b]&&' '==c[a-2][b]&&'+*O'.includes(c[a-1][b+1])&&'O*'.includes(c[a-2][b+1])||' '==c[a-2][b]&&'O*'.includes(c[a-3][b])||' '==c[a-2][b]&&'/|\\-'.includes(c[a-3][b])||'/|\\-'.includes(c[a-2][b])||'/|\\-'.includes(c[a-2][b-1])||'/|\\-'.includes(c[a-2][b+1])||'/|\\-'.includes(c[a-1][b-1])||'/|\\-'.includes(c[a-1][b+1])||'/|\\-'.includes(c[a-1][b-2])&&' '==c[a-1][b-1]||'/|\\-'.includes(c[a-1][b+2])&&' '==c[a-1][b+1])}function can_go_down_ws(a,b,c){return' :'.includes(c[a+1][b])&&!(' '==c[a+2][b]&&'/|\\-'.includes(c[a+3][b])||'/|\\-'.includes(c[a+2][b])||'/|\\-'.includes(c[a+2][b-1])||'/|\\-'.includes(c[a+2][b+1])||'/|\\-'.includes(c[a+1][b-1])||'/|\\-'.includes(c[a+1][b+1])||'/|\\-'.includes(c[a+1][b-2])&&' '==c[a+1][b-1]||'/|\\-'.includes(c[a+1][b+2])&&' '==c[a+1][b+1]||' '==c[(a-1,b)]&&!1==can_go_right_ws(a+1,b,c)&&!1==can_go_left_ws(a+1,b,c)&&!1==can_go_down_ws(a+1,b,c)&&('O*'.includes(c[a-2][b])||'O*+:'.includes(c[a][b-1])&&'O*'.includes(c[a-1][b-1])||'O*+:'.includes(c[a][b+1])&&'O*'.includes(c[a-1][b+1]))||'O*'.includes(c[a-1][b])&&!1==can_go_right_ws(a+1,b,c)&&!1==can_go_left_ws(a+1,b,c)&&!1==can_go_down_ws(a+1,b,c))}function can_go_right_ws(a,b,c){return!' :'.includes(c[a][b+1])&&('O'!=c[a][b+1]||' '!=c[a][b+2]||' '==c[a+1][b+1]&&'O*+'.includes(c[a+1][b+1])&&' '==c[a+1][b+2]&&' '==c[a][b+2])||' '==c[a][b+1]&&'O*'.includes(c[a-1][b+1])||'O+*'.includes(c[a][b+2])&&'O*'.includes(c[a-1][b+2])&&' '.includes(c[a-1][b+1])&&' '.includes(c[a][b+1])||' '==c[a][b+1]&&'O* '.includes(c[a-1][b+1])&&'O*'.includes(c[a-2][b+1])||' '==c[a-1][b+1]&&'O*'.includes(c[a-2][b+1])||'O+*'.includes(c[a-1][b])&&'O*'.includes(c[a-2][b])&&' '==c[a-1][b+1]&&' '==c[a-2][b+1]||' '==c[a][b+2]&&'/|\\-'.includes(c[a][b+3])||'/|\\-'.includes(c[a][b+2])||'/|\\-'.includes(c[a-1][b+2])||'/|\\-'.includes(c[a+1][b+2])||'/|\\-'.includes(c[a-1][b+1])||'/|\\-'.includes(c[a+1][b+1])||' '==c[a-1][b+1]&&'/|\\-'.includes(c[a-2][b+1])||' '==c[a+1][b+1]&&'/|\\-'.includes(c[a+2][b+1])?!1:!0}function can_go_left_ws(a,b,c){return!' :'.includes(c[a][b-1])&&('O'!=c[a][b-1]||' '!=c[a][b-2]||' '==c[a+1][b-1]&&'O*+'.includes(c[a+1][b-1])&&' '==c[a+1][b-2]&&' '==c[a][b-2])||' '==c[a][b-1]&&'O*'.includes(c[a-1][b-1])||'O+*'.includes(c[a][b-2])&&'O*'.includes(c[a-1][b-2])&&' '.includes(c[a-1][b-1])&&' '.includes(c[a][b-1])||' '==c[a][b-1]&&'O* '.includes(c[a-1][b-1])&&'O*'.includes(c[a-2][b-1])||' '==c[a-1][b-1]&&'O*'.includes(c[a-2][b-1])||'O+*'.includes(c[a-1][b])&&'O*'.includes(c[a-2][b])&&' '==c[a-1][b-1]&&' '==c[a-2][b-1]||' '==c[a][b-2]&&'/|\\-'.includes(c[a][b-3])||'/|\\-'.includes(c[a][b-2])||'/|\\-'.includes(c[a-1][b-2])||'/|\\-'.includes(c[a+1][b-2])||'/|\\-'.includes(c[a-1][b-1])||'/|\\-'.includes(c[a+1][b-1])||' '==c[a-1][b-1]&&'/|\\-'.includes(c[a-2][b-1])||' '==c[a+1][b-1]&&'/|\\-'.includes(c[a+2][b-1])?!1:!0}function can_go_up(a,b,c){return' :*'.includes(c[a-1][b])&&!(' '==c[a-1][b]&&'O*'.includes(c[a-2][b])||' '==c[a-1][b]&&' '==c[a-2][b]&&'+*O'.includes(c[a-1][b-1])&&'O*'.includes(c[a-2][b-1])||' '==c[a-1][b]&&' '==c[a-2][b]&&'+*O'.includes(c[a-1][b+1])&&'O*'.includes(c[a-2][b+1])||' '==c[a-2][b]&&'O*'.includes(c[a-3][b])||' '==c[a-2][b]&&'/|\\-'.includes(c[a-3][b])||'/|\\-'.includes(c[a-2][b])||'/|\\-'.includes(c[a-2][b-1])||'/|\\-'.includes(c[a-2][b+1])||'/|\\-'.includes(c[a-1][b-1])||'/|\\-'.includes(c[a-1][b+1])||'/|\\-'.includes(c[a-1][b-2])&&' '==c[a-1][b-1]||'/|\\-'.includes(c[a-1][b+2])&&' '==c[a-1][b+1])}function can_go_down(a,b,c){return' :*'.includes(c[a+1][b])&&!(' '==c[a+2][b]&&'/|\\-'.includes(c[a+3][b])||'/|\\-'.includes(c[a+2][b])||'/|\\-'.includes(c[a+2][b-1])||'/|\\-'.includes(c[a+2][b+1])||'/|\\-'.includes(c[a+1][b-1])||'/|\\-'.includes(c[a+1][b+1])||'/|\\-'.includes(c[a+1][b-2])&&' '==c[a+1][b-1]||'/|\\-'.includes(c[a+1][b+2])&&' '==c[a+1][b+1]||' '==c[(a-1,b)]&&!1==can_go_right(a+1,b,c)&&!1==can_go_left(a+1,b,c)&&!1==can_go_down(a+1,b,c)&&('O*'.includes(c[a-2][b])||'O*+:'.includes(c[a][b-1])&&'O*'.includes(c[a-1][b-1])||'O*+:'.includes(c[a][b+1])&&'O*'.includes(c[a-1][b+1]))||'O*'.includes(c[a-1][b])&&!1==can_go_right(a+1,b,c)&&!1==can_go_left(a+1,b,c)&&!1==can_go_down(a+1,b,c))}function can_go_right(a,b,c){return!' :*'.includes(c[a][b+1])&&('O'!=c[a][b+1]||' '!=c[a][b+2]||' '==c[a+1][b+1]&&'O*+'.includes(c[a+1][b+1])&&' '==c[a+1][b+2]&&' '==c[a][b+2])||' '==c[a][b+1]&&'O*'.includes(c[a-1][b+1])||'O+*'.includes(c[a][b+2])&&'O*'.includes(c[a-1][b+2])&&' '.includes(c[a-1][b+1])&&' '.includes(c[a][b+1])||' '==c[a][b+1]&&'O* '.includes(c[a-1][b+1])&&'O*'.includes(c[a-2][b+1])||' '==c[a-1][b+1]&&'O*'.includes(c[a-2][b+1])||'O+*'.includes(c[a-1][b])&&'O*'.includes(c[a-2][b])&&' '==c[a-1][b+1]&&' '==c[a-2][b+1]||' '==c[a][b+2]&&'/|\\-'.includes(c[a][b+3])||'/|\\-'.includes(c[a][b+2])||'/|\\-'.includes(c[a-1][b+2])||'/|\\-'.includes(c[a+1][b+2])||'/|\\-'.includes(c[a-1][b+1])||'/|\\-'.includes(c[a+1][b+1])||' '==c[a-1][b+1]&&'/|\\-'.includes(c[a-2][b+1])||' '==c[a+1][b+1]&&'/|\\-'.includes(c[a+2][b+1])?!1:!0}function can_go_left(a,b,c){return!' :*'.includes(c[a][b-1])&&('O'!=c[a][b-1]||' '!=c[a][b-2]||' '==c[a+1][b-1]&&'O*+'.includes(c[a+1][b-1])&&' '==c[a+1][b-2]&&' '==c[a][b-2])||' '==c[a][b-1]&&'O*'.includes(c[a-1][b-1])||'O+*'.includes(c[a][b-2])&&'O*'.includes(c[a-1][b-2])&&' '.includes(c[a-1][b-1])&&' '.includes(c[a][b-1])||' '==c[a][b-1]&&'O* '.includes(c[a-1][b-1])&&'O*'.includes(c[a-2][b-1])||' '==c[a-1][b-1]&&'O*'.includes(c[a-2][b-1])||'O+*'.includes(c[a-1][b])&&'O*'.includes(c[a-2][b])&&' '==c[a-1][b-1]&&' '==c[a-2][b-1]||' '==c[a][b-2]&&'/|\\-'.includes(c[a][b-3])||'/|\\-'.includes(c[a][b-2])||'/|\\-'.includes(c[a-1][b-2])||'/|\\-'.includes(c[a+1][b-2])||'/|\\-'.includes(c[a-1][b-1])||'/|\\-'.includes(c[a+1][b-1])||' '==c[a-1][b-1]&&'/|\\-'.includes(c[a-2][b-1])||' '==c[a+1][b-1]&&'/|\\-'.includes(c[a+2][b-1])?!1:!0}var trap_mode=0,timer=0;exports.play=function*(a){for(;;){timer++;let{x:d,y:e}=find_player(a),f='';if(6>timer&&(yield''),700>timer&&5<timer){var b=0,c=0;{let g=Array(a.length);for(let j=0;j<a.length;j++)g[j]=Array(a[j].length);for(let j=0;j<g.length;j++)for(let k=0;k<g[j].length;k++)g[j][k]='A'==a[j][k]?0:-99;let h=0;outLoop_bh:for(let j=0;80>j;j++){if(0!=j&&0==h)break outLoop_bh;h=0;for(let k=1;k<g.length-1;k++)for(let l=1;l<g[k].length-1;l++)if(g[k][l]==j){if(-99==g[k-1][l]&&'/|\\- '.includes(a[k-1][l])&&(h++,g[k-1][l]=g[k][l]+1,'/|\\-'.includes(a[k-1][l]))){b=k-1,c=l;break outLoop_bh}if(-99==g[k][l+1]&&'/|\\- '.includes(a[k][l+1])&&(h++,g[k][l+1]=g[k][l]+1,'/|\\-'.includes(a[k][l+1]))){b=k,c=l+1;break outLoop_bh}if(-99==g[k][l-1]&&'/|\\- '.includes(a[k][l-1])&&(h++,g[k][l-1]=g[k][l]+1,'/|\\-'.includes(a[k][l-1]))){b=k,c=l-1;break outLoop_bh}if(-99==g[k+1][l]&&'/|\\- '.includes(a[k+1][l])&&(h++,g[k+1][l]=g[k][l]+1,'/|\\-'.includes(a[k+1][l]))){b=k+1,c=l;break outLoop_bh}}}if(0==c&&0==b){let j=Array(a.length);for(let p=0;p<a.length;p++)j[p]=Array(a[p].length);for(let p=0;p<j.length;p++)for(let q=0;q<j[p].length;q++)j[p][q]='/|\\-'.includes(a[p][q])?0:-99;outLoop_butterfly_free:for(let p=0;6>p;p++)for(let q=1;q<j.length-1;q++)for(let r=1;r<j[q].length-1;r++)j[q][r]==p&&(-99==j[q-1][r]&&' '==a[q-1][r]&&(j[q-1][r]=j[q][r]+1),-99==j[q][r+1]&&' '==a[q][r+1]&&(j[q][r+1]=j[q][r]+1),-99==j[q][r-1]&&' '==a[q][r-1]&&(j[q][r-1]=j[q][r]+1),-99==j[q+1][r]&&' '==a[q+1][r]&&(j[q+1][r]=j[q][r]+1));let k=0,l=0,m=Array(a.length);for(let p=0;p<a.length;p++)m[p]=Array(a[p].length);for(let p=0;p<m.length;p++)for(let q=0;q<m[p].length;q++)m[p][q]='A'==a[p][q]?0:-99;outLoop_bf:for(let p=0;60>p;p++)for(let q=1;q<m.length-1;q++)for(let r=1;r<m[q].length-1;r++)if(m[q][r]==p){if(-99==m[q-1][r]&&!0==can_go_up_ws(q,r,a)&&(m[q-1][r]=m[q][r]+1,1<j[q-1][r])){k=q,l=r;break outLoop_bf}if(-99==m[q][r+1]&&!0==can_go_right_ws(q,r,a)&&(m[q][r+1]=m[q][r]+1,1<j[q][r+1])){k=q,l=r;break outLoop_bf}if(-99==m[q][r-1]&&!0==can_go_left_ws(q,r,a)&&(m[q][r-1]=m[q][r]+1,1<j[q][r-1])){k=q,l=r;break outLoop_bf}if(-99==m[q+1][r]&&!0==can_go_down_ws(q,r,a)&&(m[q+1][r]=m[q][r]+1,1<j[q+1][r])){k=q,l=r;break outLoop_bf}}let n=k,o=l;0==l&&0==k&&(timer+=5,!0==can_go_up_ws(e,d,a)&&(f+='u'),!0==can_go_down_ws(e,d,a)&&(f+='d'),!0==can_go_right_ws(e,d,a)&&(f+='r'),!0==can_go_left_ws(e,d,a)&&(f+='l'),''!=f&&(yield f[Math.floor(Math.random()*f.length)]),''==f&&(!0==can_go_up(e,d,a)&&(f+='u'),!0==can_go_down(e,d,a)&&(f+='d'),!0==can_go_right(e,d,a)&&(f+='r'),!0==can_go_left(e,d,a)&&(f+='l'),yield f[Math.floor(Math.random()*f.length)]));for(let q,p=m[n][o];1<p;p--)switch(q='',m[n-1][o]==m[n][o]-1&&(q+='y'),m[n][o+1]==m[n][o]-1&&(q+='X'),m[n+1][o]==m[n][o]-1&&(q+='Y'),m[n][o-1]==m[n][o]-1&&(q+='x'),q[Math.floor(Math.random()*q.length)]){case'x':{o--;continue}case'X':{o++;continue}case'y':{n--;continue}case'Y':{n++;continue}}o==d&&n==e-1&&(yield'u'),o==d&&n==e+1&&(yield'd'),o==d-1&&n==e&&(yield'l'),o==d+1&&n==e&&(yield'r')}if(0!=c&&0!=b){if(1==trap_mode)if('/|\\-'.includes(a[e+1][d-2])&&' '==a[e+1][d-1]||'/|\\-'.includes(a[e+1][d-1])||'/|\\-'.includes(a[e+1][d+1])||'/|\\-'.includes(a[e+1][d+2])&&' '==a[e+1][d+1]||'/|\\-'.includes(a[e+2][d])||'/|\\-'.includes(a[e+2][d+1])&&!('O*+:'.includes(a[e+2][d])&&' '==a[e+1][d+1]&&'O*+:#'.includes(a[e+1][d+2]))||'/|\\-'.includes(a[e+2][d-1])&&!(' '==a[e+1][d]&&'O*+:#'.includes(a[e+1][d-2]))||'/|\\-'.includes(a[e+3][d])&&' '==a[e+2][d]){trap_mode=0,!0==can_go_up_ws(e,d,a)&&(f+='u'),!0==can_go_right(e,d,a)&&(f+='r'),!0==can_go_left(e,d,a)&&(f+='l');for(let j=0;10>j;j++)trap_mode=0;yield f[Math.floor(Math.random()*f.length)]}else yield'';if(0==trap_mode){let j=0,k=0,l=Array(a.length);for(let o=0;o<a.length;o++)l[o]=Array(a[o].length);for(let o=0;o<l.length;o++)for(let p=0;p<l[o].length;p++)'A'==a[o][p]?l[o][p]=0:(-404!=l[o][p]&&(l[o][p]=-99),':'==a[o][p]&&':'==a[o][p+1]&&':'==a[o][p+2]&&'*O'.includes(a[o-1][p+1])&&' :'.includes(a[o+1][p+1])&&(l[o][p]=-404,l[o][p+2]=-404,l[o-1][p+1]=-404));outLoop_trap:for(let o=0;50>o;o++)for(let p=1;p<l.length-1;p++)for(let q=1;q<l[p].length-1;q++)if(l[p][q]==o){if(-99==l[p-1][q]&&!0==can_go_up_ws(p,q,a)&&(l[p-1][q]=l[p][q]+1,':'==a[p-1][q]&&':'==a[p-1][q-1]&&':'==a[p-1][q+1]&&'*O'.includes(a[p-2][q])&&(!0==can_go_up_ws(p-1,q-1,a)||!0==can_go_left_ws(p-1,q-1,a))&&(!0==can_go_up_ws(p-1,q+1,a)||!0==can_go_right_ws(p-1,q+1,a)))){j=p-1,k=q;break outLoop_trap}-99==l[p][q+1]&&!0==can_go_right_ws(p,q,a)&&(l[p][q+1]=l[p][q]+1),-99==l[p][q-1]&&!0==can_go_left_ws(p,q,a)&&(l[p][q-1]=l[p][q]+1),-99==l[p+1][q]&&!0==can_go_down_ws(p,q,a)&&(l[p+1][q]=l[p][q]+1)}let m=j,n=k;1==l[m][n]&&(trap_mode=1);for(let p,o=l[m][n];1<o;o--)switch(p='',l[m-1][n]==l[m][n]-1&&(p+='y'),l[m][n+1]==l[m][n]-1&&(p+='X'),l[m+1][n]==l[m][n]-1&&(p+='Y'),l[m][n-1]==l[m][n]-1&&(p+='x'),p[Math.floor(Math.random()*p.length)]){case'x':{n--;continue}case'X':{n++;continue}case'y':{m--;continue}case'Y':{m++;continue}}n==d&&m==e-1&&(yield'u'),n==d&&m==e+1&&(yield'd'),n==d-1&&m==e&&(yield'l'),n==d+1&&m==e&&(yield'r'),0==k&&0==j&&(timer+=5,!0==can_go_up_ws(e,d,a)&&(f+='u'),!0==can_go_down_ws(e,d,a)&&(f+='d'),!0==can_go_right_ws(e,d,a)&&(f+='r'),!0==can_go_left_ws(e,d,a)&&(f+='l'),''!=f&&(yield f[Math.floor(Math.random()*f.length)]),''==f&&(!0==can_go_up(e,d,a)&&(f+='u'),!0==can_go_down(e,d,a)&&(f+='d'),!0==can_go_right(e,d,a)&&(f+='r'),!0==can_go_left(e,d,a)&&(f+='l'),yield f[Math.floor(Math.random()*f.length)]))}}}}if(699<timer){let g=0,h=0,j=Array(a.length);for(let m=0;m<a.length;m++)j[m]=Array(a[m].length);for(let m=0;m<j.length;m++)for(let n=0;n<j[m].length;n++)j[m][n]='A'==a[m][n]?0:-99;outLoop:for(let m=0;100>m;m++)for(let n=j.length-2;0<n;n--)for(let o=j[n].length-2;0<o;o--)if(-2<j[n][o]&&11>j[n][o]&&12>m||-2<j[n][o]&&20>j[n][o]&&20>m&&11<m||-2<j[n][o]&&100>j[n][o]&&19<m){if(-99==j[n-1][o]&&!0==can_go_up(n,o,a)&&(j[n-1][o]=j[n][o]+1,'*'==a[n-1][o])){g=n-1,h=o;break outLoop}if(-99==j[n][o+1]&&!0==can_go_right(n,o,a)&&(j[n][o+1]=j[n][o]+1,'*'==a[n][o+1])){g=n,h=o+1;break outLoop}if(-99==j[n][o-1]&&!0==can_go_left(n,o,a)&&(j[n][o-1]=j[n][o]+1,'*'==a[n][o-1])){g=n,h=o-1;break outLoop}if(-99==j[n+1][o]&&!0==can_go_down(n,o,a)&&(j[n+1][o]=j[n][o]+1,'*'==a[n+1][o])){g=n+1,h=o;break outLoop}}let k=g,l=h;for(let n,m=j[k][l];1<m;m--)switch(n='',j[k-1][l]==j[k][l]-1&&(n+='y'),j[k][l+1]==j[k][l]-1&&(n+='X'),j[k+1][l]==j[k][l]-1&&(n+='Y'),j[k][l-1]==j[k][l]-1&&(n+='x'),n[Math.floor(Math.random()*n.length)]){case'x':{l--;continue}case'X':{l++;continue}case'y':{k--;continue}case'Y':{k++;continue}}l==d&&k==e-1&&(yield'u'),l==d&&k==e+1&&(yield'd'),l==d-1&&k==e&&(yield'l'),l==d+1&&k==e&&(yield'r'),0==h&&0==g&&(!0==can_go_up(e,d,a)&&(f+='u'),!0==can_go_down(e,d,a)&&(f+='d'),!0==can_go_right(e,d,a)&&(f+='r'),!0==can_go_left(e,d,a)&&(f+='l'),yield f[Math.floor(Math.random()*f.length)])}}};