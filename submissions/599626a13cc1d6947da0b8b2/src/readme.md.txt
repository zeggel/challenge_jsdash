Looking for the nearest diamond. The metric of the distance is Manhattan. Without regard to obstacles.

For the found diamond, the first possible path in the direction is calculated. The path does not take into account the butterflies and the ability to move stones.

Every step of the way before implementation is evaluated for safety. If the step is not dangerous, any non-dangerous movement is realized. After that the process begins anew.