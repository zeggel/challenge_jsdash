Описание алгоритма:
1) В момент инициализации генератора производится поиск позиции игрока и позиций всех бабочек
2) Для каждой позиции бабочки создается объект класса BTF
3) Создается матрица bad_screen, которая содержит предсталяет собой булев двухмерный массив с позициями, в которые игрок может ходить.
Данная матрица формируется на основе текущего состояния экрана, предыдущего состояния, а также прогноза падения камней и алмазов.
Опасность представляют позиции всех камней в прогнозе, а также позциии всех алмазов, которые изменят своё положение.
4) К этой матрице дополняются позиции 4 клеток вокруг бабочек (сверху/снизу/слева/справа) для текущего и следущего (прогноз) положения при условии, что бабочка жива.
5) Бабочка погибает, если в предсказанной позиции её не окажется. Если она оказалась в соседней клетке, то она остается жива, а её прогноз и состояние корректируются.
6) Если бабочка считается погибшей ошибочно (объект исчез, а на экране она всё ещё осталось), то срабатывает другой защитный механизм - бабочки окражаются клетками, в которые нельзя ходить.
7) Для каждой "хорошей" позиции формируется по алгоритму Дейкстры кратчайший путь из текущего положения.
Путь представляет собой символьную строку виду "urdl", описывающую последовательность действий до её достижения.
8) Игрок движется в сторону алмаза с минимальной длинной пути.
9) Если этот алмаз находится под камнем, то он игнорируется.
10) Если при движении до алмаза игроку нужно сделать шаг в направлении, обратном предыдущему, то он пойдёт к нему с вероятнотью 95%.
Иначе он пойдёт в сторону другого алмаза (защита от зацикливаний).
12) Если игрок оказался заблокированным, то он пытается случаным образом сдвинуть камни вокруг него.
11) Если доступных алмазов не осталось, то ключается KILLER_MODE.
В этом режиме игрок пытается обрушить камни, находящиеся над бабочками.